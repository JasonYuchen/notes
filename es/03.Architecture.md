# Chapter 03 Architecture

## The building blocks

### Documents

```json
{
  "title": "John Doe",
  "date_of_birth": "1972-14-03",
  "age": 23,
  "address": {
    "location": {
      "lat": "51.5",
      "long": "0.12"
    }
  }
}
```

### Indexes

- **Shards**: physical instances of Apache Lucene

![](images/03.05.png)

### Data streams

![](images/03.07.png)

### Shards and replicas

![](images/03.08.png)

- Heath status of a cluster, `GET _cluster/health`
	- **RED**: not all shards are assigned and ready
	- **YELLOW**: shards are assigned and ready, but replicas are not
	- **GREEN**: shards and replicas are assigned and ready

- Rebalance of an index when new node joins the cluster

	![](images/03.11.png)
	
	![](images/03.13.png)

- **Sizing**: normally 25-40 GB / shard, (up to 20 shards per GB of heap memory)
- Shards number cannot be modified on a live index due to routing algorithm (use **reindex**)

	`shard_number = hash(document_id) % number_of_primary_shards`

### Nodes and clusters

![](images/03.16.png)

- **Master node**: cluster management, indexes management, admin-related jobs
- **Data node**: indexing, searching, deleting, document-related operations
- **Ingest node**: ingest operations
- **Machine learning node**: ml-related tasks, detects anomalies
- **Coordinating node**: all nodes take on this special role to coordinate client's requests

## Inverted Indexes

