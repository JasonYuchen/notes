# Your Load Generator Is Probably Lying To You

[original post](http://highscalability.com/blog/2015/10/5/your-load-generator-is-probably-lying-to-you-take-the-red-pi.html)

## 协调遗漏问题 The Coordinated Omission Problem

Coordinated Omission问题主要描述了不良设计的观测系统会丢失一些关键的数据点，从而导致最后的延迟分布等数据失真，可能在如下场景中出现：

- **压力测试 Load Testing**
  通常压力测试的生成器会根据一定速率生成请求并访问被测系统，记录每个请求的响应时间，并每隔一定时间收集积累的响应时间生成延迟分布图，P99等数据

  这里有一个致命的问题，例如测试系统每隔1秒发出请求，但是某一次请求的延迟达到了1.5秒，则本应在1秒时发出的第二个请求延迟了0.5秒再发出（等同于排队时间0.5秒），此时再记录**收到响应与发出请求的时间差作为延迟数据，就丢失了排队延迟**

  因此只有当响应时间短于压力测试的请求发送间隔时，数据才没有失真，例如YCSB等常见的压力测试系统引入**意向时间intended time**，即意图发起请求的时间，此事件会早于或等于实际发出请求的时间，而**延迟就修改为收到响应与意向时间的时间差，此时就包含了等待时间**

- **监测系统 Monitoring Code**
  与压力测试同理，通常监测系统会在某次调用前后加上两个时间戳来记录时间差，此时假如某次调用耗时很长而阻塞了后面的调用，则**后面的调用都在排队等候，但这些事件也不会被监测系统的时间戳记录**

协调遗漏实际上使得测试延迟时间的设计变成了测试服务时间，而**真正的延迟时间是服务时间与等候时间之和**，因此在**请求产生的时刻就引入意向时间**来解决不真实的数据分布问题
